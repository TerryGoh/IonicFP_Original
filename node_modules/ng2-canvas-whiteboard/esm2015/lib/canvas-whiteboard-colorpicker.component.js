import { Component, Output, EventEmitter, ViewChild, ElementRef, Input } from '@angular/core';
export class CanvasWhiteboardColorPickerComponent {
    constructor(elementRef) {
        this.elementRef = elementRef;
        this.selectedColor = 'rgba(0,0,0,1)';
        this.showColorPicker = false;
        this.onToggleColorPicker = new EventEmitter();
        this.onColorSelected = new EventEmitter();
        this.onSecondaryColorSelected = new EventEmitter();
    }
    /**
     * Initialize the canvas drawing context. If we have an aspect ratio set up, the canvas will resize
     * according to the aspect ratio.
     */
    ngOnInit() {
        this._context = this.canvas.nativeElement.getContext('2d');
        this.createColorPalette();
    }
    createColorPalette() {
        let gradient = this._context.createLinearGradient(0, 0, this._context.canvas.width, 0);
        gradient.addColorStop(0, 'rgb(255, 0, 0)');
        gradient.addColorStop(0.15, 'rgb(255, 0, 255)');
        gradient.addColorStop(0.33, 'rgb(0, 0, 255)');
        gradient.addColorStop(0.49, 'rgb(0, 255, 255)');
        gradient.addColorStop(0.67, 'rgb(0, 255, 0)');
        gradient.addColorStop(0.84, 'rgb(255, 255, 0)');
        gradient.addColorStop(1, 'rgb(255, 0, 0)');
        this._context.fillStyle = gradient;
        this._context.fillRect(0, 0, this._context.canvas.width, this._context.canvas.height);
        gradient = this._context.createLinearGradient(0, 0, 0, this._context.canvas.height);
        gradient.addColorStop(0, 'rgba(255, 255, 255, 1)');
        gradient.addColorStop(0.5, 'rgba(255, 255, 255, 0)');
        gradient.addColorStop(0.5, 'rgba(0, 0, 0, 0)');
        gradient.addColorStop(1, 'rgba(0, 0, 0, 1)');
        this._context.fillStyle = gradient;
        this._context.fillRect(0, 0, this._context.canvas.width, this._context.canvas.height);
    }
    closeOnExternalClick(event) {
        if (!this.elementRef.nativeElement.contains(event.target) && this.showColorPicker) {
            this.onToggleColorPicker.emit(false);
        }
    }
    toggleColorPicker(event) {
        if (event) {
            event.preventDefault();
        }
        this.onToggleColorPicker.emit(!this.showColorPicker);
    }
    determineColorFromCanvas(event) {
        const canvasRect = this._context.canvas.getBoundingClientRect();
        const imageData = this._context.getImageData(event.clientX - canvasRect.left, event.clientY - canvasRect.top, 1, 1);
        return `rgba(${imageData.data[0]}, ${imageData.data[1]}, ${imageData.data[2]}, ${imageData.data[3]})`;
    }
    selectColor(color) {
        this.onColorSelected.emit(color);
        this.toggleColorPicker(null);
    }
}
CanvasWhiteboardColorPickerComponent.decorators = [
    { type: Component, args: [{
                selector: 'canvas-whiteboard-colorpicker',
                host: {
                    '(document:mousedown)': 'closeOnExternalClick($event)',
                    '(document:touchstart)': 'closeOnExternalClick($event)'
                },
                template: `
    <div [hidden]="showColorPicker" class="canvas-whiteboard-colorpicker-input"
         (click)="toggleColorPicker($event)">
      <div class="selected-color-type-wrapper">{{previewText}}</div>
      <div class="selected-color-preview" [style.background]="selectedColor"></div>
    </div>
    <div [hidden]="!showColorPicker" class="canvas-whiteboard-colorpicker-wrapper">
      <div (click)="selectColor('transparent')" class="transparent-color">Transparent</div>
      <canvas #canvaswhiteboardcolorpicker class="canvas-whiteboard-colorpicker" width="284" height="155"
              (click)="selectColor(determineColorFromCanvas($event))"></canvas>
    </div>
  `,
                styles: [`
    .selected-color-preview {
      width: 100%;
      height: 20%;
      position: absolute;
      bottom: 0;
      left: 0;
    }

    .selected-color-type-wrapper {
      display: inline-block;
      height: 100%;
      width: 100%;
      text-align: center;
      font-size: 14px;
      color: #000;
    }

    .transparent-color {
      font-size: 14px;
    }

    .canvas-whiteboard-colorpicker-wrapper {
      border: 1px solid #afafaf;
      color: #000;
    }

    @media (min-width: 401px) {
      .canvas-whiteboard-colorpicker-wrapper {
        position: absolute;
      }
    }

    .canvas-whiteboard-colorpicker-input {
      display: inline-block;
      position: relative;
      width: 44px;
      height: 44px;
      margin: 5px;
      cursor: pointer;
      color: #000;
    }
  `]
            },] }
];
CanvasWhiteboardColorPickerComponent.ctorParameters = () => [
    { type: ElementRef }
];
CanvasWhiteboardColorPickerComponent.propDecorators = {
    previewText: [{ type: Input }],
    selectedColor: [{ type: Input }],
    canvas: [{ type: ViewChild, args: ['canvaswhiteboardcolorpicker', { static: true },] }],
    showColorPicker: [{ type: Input }],
    onToggleColorPicker: [{ type: Output }],
    onColorSelected: [{ type: Output }],
    onSecondaryColorSelected: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FudmFzLXdoaXRlYm9hcmQtY29sb3JwaWNrZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmcyLWNhbnZhcy13aGl0ZWJvYXJkL3NyYy9saWIvY2FudmFzLXdoaXRlYm9hcmQtY29sb3JwaWNrZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsTUFBTSxFQUNOLFlBQVksRUFBVSxTQUFTLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFDbkQsTUFBTSxlQUFlLENBQUM7QUFnRXZCLE1BQU0sT0FBTyxvQ0FBb0M7SUFhL0MsWUFBb0IsVUFBc0I7UUFBdEIsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQVZ4QixrQkFBYSxHQUFXLGVBQWUsQ0FBQztRQUd4QyxvQkFBZSxHQUFZLEtBQUssQ0FBQztRQUd6Qyx3QkFBbUIsR0FBRyxJQUFJLFlBQVksRUFBVyxDQUFDO1FBQ2xELG9CQUFlLEdBQUcsSUFBSSxZQUFZLEVBQVUsQ0FBQztRQUM3Qyw2QkFBd0IsR0FBRyxJQUFJLFlBQVksRUFBVSxDQUFDO0lBR2hFLENBQUM7SUFFRDs7O09BR0c7SUFDSCxRQUFRO1FBQ04sSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0QsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7SUFDNUIsQ0FBQztJQUVELGtCQUFrQjtRQUNoQixJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLG9CQUFvQixDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3ZGLFFBQVEsQ0FBQyxZQUFZLENBQUMsQ0FBQyxFQUFFLGdCQUFnQixDQUFDLENBQUM7UUFDM0MsUUFBUSxD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QUFXLENBQUMsS0FBYTtRQUN2QixJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNqQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDL0IsQ0FBQzs7O1lBcklGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsK0JBQStCO2dCQUN6QyxJQUFJLEVBQUU7b0JBQ0osc0JBQXNCLEVBQUUsOEJBQThCO29CQUN0RCx1QkFBdUIsRUFBRSw4QkFBOEI7aUJBQ3hEO2dCQUNELFFBQVEsRUFBRTs7Ozs7Ozs7Ozs7R0FXVDt5QkFDUTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBMENSO2FBQ0Y7OztZQWhFa0MsVUFBVTs7OzBCQW1FMUMsS0FBSzs0QkFDTCxLQUFLO3FCQUNMLFNBQVMsU0FBQyw2QkFBNkIsRUFBRSxFQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUM7OEJBRXZELEtBQUs7a0NBR0wsTUFBTTs4QkFDTixNQUFNO3VDQUNOLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnQsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLCBPbkluaXQsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiwgSW5wdXRcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2NhbnZhcy13aGl0ZWJvYXJkLWNvbG9ycGlja2VyJyxcbiAgaG9zdDoge1xuICAgICcoZG9jdW1lbnQ6bW91c2Vkb3duKSc6ICdjbG9zZU9uRXh0ZXJuYWxDbGljaygkZXZlbnQpJyxcbiAgICAnKGRvY3VtZW50OnRvdWNoc3RhcnQpJzogJ2Nsb3NlT25FeHRlcm5hbENsaWNrKCRldmVudCknXG4gIH0sXG4gIHRlbXBsYXRlOiBgXG4gICAgPGRpdiBbaGlkZGVuXT1cInNob3dDb2xvclBpY2tlclwiIGNsYXNzPVwiY2FudmFzLXdoaXRlYm9hcmQtY29sb3JwaWNrZXItaW5wdXRcIlxuICAgICAgICAgKGNsaWNrKT1cInRvZ2dsZUNvbG9yUGlja2VyKCRldmVudClcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJzZWxlY3RlZC1jb2xvci10eXBlLXdyYXBwZXJcIj57e3ByZXZpZXdUZXh0fX08L2Rpdj5cbiAgICAgIDxkaXYgY2xhc3M9XCJzZWxlY3RlZC1jb2xvci1wcmV2aWV3XCIgW3N0eWxlLmJhY2tncm91bmRdPVwic2VsZWN0ZWRDb2xvclwiPjwvZGl2PlxuICAgIDwvZGl2PlxuICAgIDxkaXYgW2hpZGRlbl09XCIhc2hvd0NvbG9yUGlja2VyXCIgY2xhc3M9XCJjYW52YXMtd2hpdGVib2FyZC1jb2xvcnBpY2tlci13cmFwcGVyXCI+XG4gICAgICA8ZGl2IChjbGljayk9XCJzZWxlY3RDb2xvcigndHJhbnNwYXJlbnQnKVwiIGNsYXNzPVwidHJhbnNwYXJlbnQtY29sb3JcIj5UcmFuc3BhcmVudDwvZGl2PlxuICAgICAgPGNhbnZhcyAjY2FudmFzd2hpdGVib2FyZGNvbG9ycGlja2VyIGNsYXNzPVwiY2FudmFzLXdoaXRlYm9hcmQtY29sb3JwaWNrZXJcIiB3aWR0aD1cIjI4NFwiIGhlaWdodD1cIjE1NVwiXG4gICAgICAgICAgICAgIChjbGljayk9XCJzZWxlY3RDb2xvcihkZXRlcm1pbmVDb2xvckZyb21DYW52YXMoJGV2ZW50KSlcIj48L2NhbnZhcz5cbiAgICA8L2Rpdj5cbiAgYCxcbiAgc3R5bGVzOiBbYFxuICAgIC5zZWxlY3RlZC1jb2xvci1wcmV2aWV3IHtcbiAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgaGVpZ2h0OiAyMCU7XG4gICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XG4gICAgICBib3R0b206IDA7XG4gICAgICBsZWZ0OiAwO1xuICAgIH1cblxuICAgIC5zZWxlY3RlZC1jb2xvci10eXBlLXdyYXBwZXIge1xuICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuICAgICAgaGVpZ2h0OiAxMDAlO1xuICAgICAgd2lkdGg6IDEwMCU7XG4gICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgICBmb250LXNpemU6IDE0cHg7XG4gICAgICBjb2xvcjogIzAwMDtcbiAgICB9XG5cbiAgICAudHJhbnNwYXJlbnQtY29sb3Ige1xuICAgICAgZm9udC1zaXplOiAxNHB4O1xuICAgIH1cblxuICAgIC5jYW52YXMtd2hpdGVib2FyZC1jb2xvcnBpY2tlci13cmFwcGVyIHtcbiAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNhZmFmYWY7XG4gICAgICBjb2xvcjogIzAwMDtcbiAgICB9XG5cbiAgICBAbWVkaWEgKG1pbi13aWR0aDogNDAxcHgpIHtcbiAgICAgIC5jYW52YXMtd2hpdGVib2FyZC1jb2xvcnBpY2tlci13cmFwcGVyIHtcbiAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgfVxuICAgIH1cblxuICAgIC5jYW52YXMtd2hpdGVib2FyZC1jb2xvcnBpY2tlci1pbnB1dCB7XG4gICAgICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XG4gICAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgICB3aWR0aDogNDRweDtcbiAgICAgIGhlaWdodDogNDRweDtcbiAgICAgIG1hcmdpbjogNXB4O1xuICAgICAgY3Vyc29yOiBwb2ludGVyO1xuICAgICAgY29sb3I6ICMwMDA7XG4gICAgfVxuICBgXVxufSlcbmV4cG9ydCBjbGFzcyBDYW52YXNXaGl0ZWJvYXJkQ29sb3JQaWNrZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gIEBJbnB1dCgpIHByZXZpZXdUZXh0OiBzdHJpbmc7XG4gIEBJbnB1dCgpIHJlYWRvbmx5IHNlbGVjdGVkQ29sb3I6IHN0cmluZyA9ICdyZ2JhKDAsMCwwLDEpJztcbiAgQFZpZXdDaGlsZCgnY2FudmFzd2hpdGVib2FyZGNvbG9ycGlja2VyJywge3N0YXRpYzogdHJ1ZX0pIGNhbnZhczogRWxlbWVudFJlZjtcblxuICBASW5wdXQoKSByZWFkb25seSBzaG93Q29sb3JQaWNrZXI6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBfY29udGV4dDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEO1xuXG4gIEBPdXRwdXQoKSBvblRvZ2dsZUNvbG9yUGlja2VyID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xuICBAT3V0cHV0KCkgb25Db2xvclNlbGVjdGVkID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XG4gIEBPdXRwdXQoKSBvblNlY29uZGFyeUNvbG9yU2VsZWN0ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZz4oKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYpIHtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIHRoZSBjYW52YXMgZHJhd2luZyBjb250ZXh0LiBJZiB3ZSBoYXZlIGFuIGFzcGVjdCByYXRpbyBzZXQgdXAsIHRoZSBjYW52YXMgd2lsbCByZXNpemVcbiAgICogYWNjb3JkaW5nIHRvIHRoZSBhc3BlY3QgcmF0aW8uXG4gICAqL1xuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLl9jb250ZXh0ID0gdGhpcy5jYW52YXMubmF0aXZlRWxlbWVudC5nZXRDb250ZXh0KCcyZCcpO1xuICAgIHRoaXMuY3JlYXRlQ29sb3JQYWxldHRlKCk7XG4gIH1cblxuICBjcmVhdGVDb2xvclBhbGV0dGUoKTogdm9pZCB7XG4gICAgbGV0IGdyYWRpZW50ID0gdGhpcy5fY29udGV4dC5jcmVhdGVMaW5lYXJHcmFkaWVudCgwLCAwLCB0aGlzLl9jb250ZXh0LmNhbnZhcy53aWR0aCwgMCk7XG4gICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDAsICdyZ2IoMjU1LCAwLCAwKScpO1xuICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgwLjE1LCAncmdiKDI1NSwgMCwgMjU1KScpO1xuICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgwLjMzLCAncmdiKDAsIDAsIDI1NSknKTtcbiAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMC40OSwgJ3JnYigwLCAyNTUsIDI1NSknKTtcbiAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMC42NywgJ3JnYigwLCAyNTUsIDApJyk7XG4gICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDAuODQsICdyZ2IoMjU1LCAyNTUsIDApJyk7XG4gICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDEsICdyZ2IoMjU1LCAwLCAwKScpO1xuICAgIHRoaXMuX2NvbnRleHQuZmlsbFN0eWxlID0gZ3JhZGllbnQ7XG4gICAgdGhpcy5fY29udGV4dC5maWxsUmVjdCgwLCAwLCB0aGlzLl9jb250ZXh0LmNhbnZhcy53aWR0aCwgdGhpcy5fY29udGV4dC5jYW52YXMuaGVpZ2h0KTtcblxuICAgIGdyYWRpZW50ID0gdGhpcy5fY29udGV4dC5jcmVhdGVMaW5lYXJHcmFkaWVudCgwLCAwLCAwLCB0aGlzLl9jb250ZXh0LmNhbnZhcy5oZWlnaHQpO1xuICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgwLCAncmdiYSgyNTUsIDI1NSwgMjU1LCAxKScpO1xuICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgwLjUsICdyZ2JhKDI1NSwgMjU1LCAyNTUsIDApJyk7XG4gICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDAuNSwgJ3JnYmEoMCwgMCwgMCwgMCknKTtcbiAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMSwgJ3JnYmEoMCwgMCwgMCwgMSknKTtcbiAgICB0aGlzLl9jb250ZXh0LmZpbGxTdHlsZSA9IGdyYWRpZW50O1xuICAgIHRoaXMuX2NvbnRleHQuZmlsbFJlY3QoMCwgMCwgdGhpcy5fY29udGV4dC5jYW52YXMud2lkdGgsIHRoaXMuX2NvbnRleHQuY2FudmFzLmhlaWdodCk7XG4gIH1cblxuICBjbG9zZU9uRXh0ZXJuYWxDbGljayhldmVudCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuY29udGFpbnMoZXZlbnQudGFyZ2V0KSAmJiB0aGlzLnNob3dDb2xvclBpY2tlcikge1xuICAgICAgdGhpcy5vblRvZ2dsZUNvbG9yUGlja2VyLmVtaXQoZmFsc2UpO1xuICAgIH1cbiAgfVxuXG4gIHRvZ2dsZUNvbG9yUGlja2VyKGV2ZW50OiBFdmVudCk6IHZvaWQge1xuICAgIGlmIChldmVudCkge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG5cbiAgICB0aGlzLm9uVG9nZ2xlQ29sb3JQaWNrZXIuZW1pdCghdGhpcy5zaG93Q29sb3JQaWNrZXIpO1xuICB9XG5cbiAgZGV0ZXJtaW5lQ29sb3JGcm9tQ2FudmFzKGV2ZW50OiBhbnkpOiBzdHJpbmcge1xuICAgIGNvbnN0IGNhbnZhc1JlY3QgPSB0aGlzLl9jb250ZXh0LmNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBjb25zdCBpbWFnZURhdGEgPSB0aGlzLl9jb250ZXh0LmdldEltYWdlRGF0YShldmVudC5jbGllbnRYIC0gY2FudmFzUmVjdC5sZWZ0LFxuICAgICAgZXZlbnQuY2xpZW50WSAtIGNhbnZhc1JlY3QudG9wLCAxLCAxKTtcblxuICAgIHJldHVybiBgcmdiYSgke2ltYWdlRGF0YS5kYXRhWzBdfSwgJHtpbWFnZURhdGEuZGF0YVsxXX0sICR7aW1hZ2VEYXRhLmRhdGFbMl19LCAke2ltYWdlRGF0YS5kYXRhWzNdfSlgO1xuICB9XG5cbiAgc2VsZWN0Q29sb3IoY29sb3I6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMub25Db2xvclNlbGVjdGVkLmVtaXQoY29sb3IpO1xuICAgIHRoaXMudG9nZ2xlQ29sb3JQaWNrZXIobnVsbCk7XG4gIH1cbn1cbiJdfQ==